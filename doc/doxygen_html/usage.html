<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>btftoolchain: How to use the library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">btftoolchain
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('usage.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">How to use the library </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_doc_md_usage"></a></p>
<p>This section describes how to use the btf-toolchain. An user can choose to either work with either the provided C++ API or the Python API. <br  />
For the Python API to work the C++ libraries must be built. In both cases the btf-toolchain provides the necessary functions to create a syntactically correct BTF file. <br  />
At the end of the document there are some important notes regarding the use of the btf-toolchain. <br  />
</p><hr  />
 <h1><a class="anchor" id="autotoc_md8"></a>
C++</h1>
<p>This section shows the possible functionalities of the C++ libraries. The following Getting Started subsection shows the intended workflow when creating a BTF file. <br  />
Furthermore, the Logging subsection describes how the logging feature works and the Testing subsection explains where to find the test cases for the btf-toolchain.<br  />
 </p>
<h2><a class="anchor" id="autotoc_md9"></a>
Getting started</h2>
<p>To work with BTF files an object of type BtfFile is required. This can be created by calling the constructor of <a class="el" href="classbtf_1_1_btf_file.html" title="Main class of the btf lib. It contains all necessary functions to import and export a BTF file.">btf::BtfFile</a> <br  />
(A detailed description of the constructor and its input parameters can be found in the source code documentation).</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="btf_8h.html">btf.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><a class="code" href="classbtf_1_1_btf_file.html">btf::BtfFile</a> btfFile(<span class="stringliteral">&quot;test.btf&quot;</span>);</div>
<div class="ttc" id="abtf_8h_html"><div class="ttname"><a href="btf_8h.html">btf.h</a></div></div>
<div class="ttc" id="aclassbtf_1_1_btf_file_html"><div class="ttname"><a href="classbtf_1_1_btf_file.html">btf::BtfFile</a></div><div class="ttdoc">Main class of the btf lib. It contains all necessary functions to import and export a BTF file.</div><div class="ttdef"><b>Definition:</b> btf.h:194</div></div>
</div><!-- fragment --><p>Now either an existing BTF file can be read in: </p><div class="fragment"><div class="line">btfFile.importFromFile(<span class="stringliteral">&quot;input.btf&quot;</span>);</div>
</div><!-- fragment --><p>Or events can be emitted: </p><div class="fragment"><div class="line">btfFile.processEvent(100, <span class="stringliteral">&quot;Core1&quot;</span>, <span class="stringliteral">&quot;Task1&quot;</span>, 0, <a class="code" href="classbtf_1_1_process.html#a690e203377baa8f5d0af54b4cd281996aea2b2676c28c0db26d39331a336c6b92">btf::Process::Events::start</a>, <span class="keyword">true</span>);</div>
<div class="line"><a class="code" href="namespacebtf.html">btf</a>.runnableEvent(200, <span class="stringliteral">&quot;Core1&quot;</span>, <span class="stringliteral">&quot;Runnable1&quot;</span>, <a class="code" href="classbtf_1_1_runnable.html#a7a779e70f17aafbe2612bd15fd662d65aea2b2676c28c0db26d39331a336c6b92">btf::Runnable::Events::start</a>);</div>
<div class="ttc" id="aclassbtf_1_1_process_html_a690e203377baa8f5d0af54b4cd281996aea2b2676c28c0db26d39331a336c6b92"><div class="ttname"><a href="classbtf_1_1_process.html#a690e203377baa8f5d0af54b4cd281996aea2b2676c28c0db26d39331a336c6b92">btf::Process::Events::start</a></div><div class="ttdeci">@ start</div><div class="ttdoc">The start event indicates that a process (target) that is active for execution gets scheduled and all...</div></div>
<div class="ttc" id="aclassbtf_1_1_runnable_html_a7a779e70f17aafbe2612bd15fd662d65aea2b2676c28c0db26d39331a336c6b92"><div class="ttname"><a href="classbtf_1_1_runnable.html#a7a779e70f17aafbe2612bd15fd662d65aea2b2676c28c0db26d39331a336c6b92">btf::Runnable::Events::start</a></div><div class="ttdeci">@ start</div><div class="ttdoc">The start event indicates that a runnable (target) gets called by a process (source) and starts execu...</div></div>
<div class="ttc" id="anamespacebtf_html"><div class="ttname"><a href="namespacebtf.html">btf</a></div><div class="ttdef"><b>Definition:</b> btf.h:43</div></div>
</div><!-- fragment --><p>To write the BTF file to disc, run: </p><div class="fragment"><div class="line">btfFile.finish();</div>
</div><!-- fragment --><p> For more examples, see the Testing subsection. <br  />
</p>
<h2><a class="anchor" id="autotoc_md10"></a>
Logging</h2>
<p>The btf-toolchain also includes a logging library that allows you to print log message to the console or to a file. The library supports multiple log levels:</p><ul>
<li>error</li>
<li>warning</li>
<li>trace</li>
</ul>
<p>The default behavior is log level warning and printing the message to cout. This can be changed by calling initLogging:</p>
<div class="fragment"><div class="line"><a class="code" href="namespacehelper_1_1logging.html#a07c8ea0d769c17b04f96a11ea545f8e8">helper::logging::initLogging</a>(<a class="code" href="namespacehelper_1_1logging.html#a4e0ebc8475f12f880b1e2a4c8aefa5e1a04a75036e9d520bb983c5ed03b8d0182">helper::logging::LogLevel::trace</a>, <span class="stringliteral">&quot;log.txt&quot;</span>);</div>
<div class="ttc" id="anamespacehelper_1_1logging_html_a07c8ea0d769c17b04f96a11ea545f8e8"><div class="ttname"><a href="namespacehelper_1_1logging.html#a07c8ea0d769c17b04f96a11ea545f8e8">helper::logging::initLogging</a></div><div class="ttdeci">void initLogging(LogLevel log_level, const std::string &amp;log_file_path=&quot;&quot;)</div><div class="ttdoc">Initalizes the logging feature.</div><div class="ttdef"><b>Definition:</b> logging.cpp:83</div></div>
<div class="ttc" id="anamespacehelper_1_1logging_html_a4e0ebc8475f12f880b1e2a4c8aefa5e1a04a75036e9d520bb983c5ed03b8d0182"><div class="ttname"><a href="namespacehelper_1_1logging.html#a4e0ebc8475f12f880b1e2a4c8aefa5e1a04a75036e9d520bb983c5ed03b8d0182">helper::logging::LogLevel::trace</a></div><div class="ttdeci">@ trace</div><div class="ttdoc">Adds &quot;Trace&quot; before the log message.</div></div>
</div><!-- fragment --><p>This tells the libraries to print all possible messages and write them to the log.txt file. If the string to the file is empty, the messages are printed to cout.</p>
<p>A log message can be written with:</p>
<div class="fragment"><div class="line"><a class="code" href="namespacehelper_1_1logging.html#a0e1881bbc937b702aa298c5f5141b79b">helper::logging::printTrace</a>() &lt;&lt; <span class="stringliteral">&quot;This is a trace message&quot;</span> &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"><a class="code" href="namespacehelper_1_1logging.html#a9181c24054b42b4c6b18afff28b762bb">helper::logging::printWarning</a>() &lt;&lt; <span class="stringliteral">&quot;This is a warning message&quot;</span> &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"><a class="code" href="namespacehelper_1_1logging.html#a182d159db05f7638d388b4ee9740af04">helper::logging::printError</a>() &lt;&lt; <span class="stringliteral">&quot;This is an error message&quot;</span> &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="ttc" id="anamespacehelper_1_1logging_html_a0e1881bbc937b702aa298c5f5141b79b"><div class="ttname"><a href="namespacehelper_1_1logging.html#a0e1881bbc937b702aa298c5f5141b79b">helper::logging::printTrace</a></div><div class="ttdeci">std::ostream &amp; printTrace(const source_location location=source_location::current())</div><div class="ttdoc">Writes a trace message to the log.</div><div class="ttdef"><b>Definition:</b> logging.cpp:102</div></div>
<div class="ttc" id="anamespacehelper_1_1logging_html_a182d159db05f7638d388b4ee9740af04"><div class="ttname"><a href="namespacehelper_1_1logging.html#a182d159db05f7638d388b4ee9740af04">helper::logging::printError</a></div><div class="ttdeci">std::ostream &amp; printError(const source_location location=source_location::current())</div><div class="ttdoc">Writes an error message to the log.</div><div class="ttdef"><b>Definition:</b> logging.cpp:92</div></div>
<div class="ttc" id="anamespacehelper_1_1logging_html_a9181c24054b42b4c6b18afff28b762bb"><div class="ttname"><a href="namespacehelper_1_1logging.html#a9181c24054b42b4c6b18afff28b762bb">helper::logging::printWarning</a></div><div class="ttdeci">std::ostream &amp; printWarning(const source_location location=source_location::current())</div><div class="ttdoc">Writes a warning message to the log.</div><div class="ttdef"><b>Definition:</b> logging.cpp:97</div></div>
</div><!-- fragment --><p>To write the log data into the file the logger must be flushed:</p>
<div class="fragment"><div class="line"><a class="code" href="namespacehelper_1_1logging.html#a8405ad51527364dd7ad47a226e4bab85">helper::logging::flush</a>();</div>
<div class="ttc" id="anamespacehelper_1_1logging_html_a8405ad51527364dd7ad47a226e4bab85"><div class="ttname"><a href="namespacehelper_1_1logging.html#a8405ad51527364dd7ad47a226e4bab85">helper::logging::flush</a></div><div class="ttdeci">void flush()</div><div class="ttdoc">Flushes the log.</div><div class="ttdef"><b>Definition:</b> logging.cpp:145</div></div>
</div><!-- fragment --><p> <br  />
</p>
<h2><a class="anchor" id="autotoc_md11"></a>
Testing</h2>
<p>The btf-toolchain contains a test setup created using the catch2 framework. To enable the testing framework, activate the ENABLE_TESTING option. <br  />
 The test cases check the basic functionality of the btf-toolchain. They can be found in test/libBtfTest.cpp. <br  />
In total, the file contains 22 test cases with different example use cases of the btf library and one test case for the logging feature. <br  />
To run the tests, execute test.exe in /build/test/Debug/ after building the project with cmake. <br  />
<br  />
</p><hr  />
 <h1><a class="anchor" id="autotoc_md12"></a>
Python</h1>
<p>The C++ APIs are also exposed to Python and can be used in a Python script. Only the pybtf module, which is the link to the C++ library needs, to be imported. <br  />
</p>
<h2><a class="anchor" id="autotoc_md13"></a>
Getting started</h2>
<p>To work with BTF files an object of type BtfFile is required. This can be created by calling the C++ constructor of BtfFile via the Python binding.</p>
<div class="fragment"><div class="line"><span class="keyword">import</span> pybtf</div>
<div class="line"> </div>
<div class="line">btfFile = pybtf.pybtf.BtfFile(<span class="stringliteral">&quot;test.btf&quot;</span>, pybtf.pybtf.BtfFile.Timescale.nano_seconds, <span class="keyword">True</span>, <span class="keyword">True</span>, <span class="keyword">False</span>, <span class="keyword">False</span>)</div>
</div><!-- fragment --><p>The meaning of the three boolean parameters is explained in the Important Notes section. Next, either an existing BTF file can be imported: </p><div class="fragment"><div class="line">btfFile.importFromFile(<span class="stringliteral">&quot;input.btf&quot;</span>)</div>
</div><!-- fragment --><p>Or events can be emitted: </p><div class="fragment"><div class="line">btfFile.processEvent(100, <span class="stringliteral">&quot;Core1&quot;</span>, <span class="stringliteral">&quot;Task1&quot;</span>, 0, pybtf.pybtf.ProcessEvent.start, <span class="keyword">True</span>)</div>
<div class="line">btfFile.runnableEvent(200, <span class="stringliteral">&quot;Core1&quot;</span>, <span class="stringliteral">&quot;Runnable1&quot;</span>, pybtf.pybtf.RunnableEvent.start)</div>
</div><!-- fragment --><p>To write the BTF file to disc, run: </p><div class="fragment"><div class="line">btfFile.finish()</div>
</div><!-- fragment --><p> <br  />
</p>
<h2><a class="anchor" id="autotoc_md14"></a>
Logging</h2>
<p>The logging library can also be used in Python using the Python binding. <br  />
Here, the default behavior is also log level warning and printing the message to cout. This can be changed by calling initLogging:</p>
<div class="fragment"><div class="line"><span class="keyword">import</span> pybtf</div>
<div class="line">pybtf.pybtf.helper.initLogging(pybtf.pybtf.helper.LogLevel.trace, <span class="stringliteral">&quot;log.txt&quot;</span>)</div>
</div><!-- fragment --><p>A log message can be written with: </p><div class="fragment"><div class="line">pybtf.pybtf.helper.Log(pybtf.pybtf.helper.LogLevel.trace, <span class="stringliteral">&quot;This is a trace message&quot;</span>)</div>
<div class="line">pybtf.pybtf.helper.Log(pybtf.pybtf.helper.LogLevel.warning, <span class="stringliteral">&quot;This is a warning message&quot;</span>)</div>
<div class="line">pybtf.pybtf.helper.Log(pybtf.pybtf.helper.LogLevel.error, <span class="stringliteral">&quot;This is an error message&quot;</span>)</div>
</div><!-- fragment --><p>To write log data to the file, the logger must be flushed: </p><div class="fragment"><div class="line">pybtf.pybtf.helper.flushLog()</div>
</div><!-- fragment --><p> <br  />
</p>
<h2><a class="anchor" id="autotoc_md15"></a>
Testing</h2>
<p>For the Python version of the btf-toolchain there is also a test framework based on the unittest module. <br  />
The test file contains the same tests as the C++ version and is located in pytest/test.py. <br  />
To execute the test framework, open the pytest folder in a command prompt and execute test.py:</p>
<div class="fragment"><div class="line">python test.py</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md16"></a>
Example Converter</h2>
<p>In addition to the test framework, an example for a csv to BTF converter in Python is also provided. <br  />
The example converter is located in pytest/csv_example.py and can convert the file trace.csv to a btf file. <br  />
trace.csv is a short system flow trace created with <a href="https://www.lauterbach.com/">Lauterbach</a>. Please note that this script is just a simple example of how the btf-toolchain can be used and does not cover every csv to BTF use case.<br  />
However, it can be used as a template to get started. <br  />
<br  />
</p><hr  />
 <h1><a class="anchor" id="autotoc_md17"></a>
Important Notes</h1>
<p>This section contains further information on best practices, limitations and general usage of the btf-toolchain. <br  />
</p>
<h2><a class="anchor" id="autotoc_md18"></a>
Input Parameters</h2>
<p>In general, the input parameters of the functions and their description can be found in the source code documentation. <br  />
Here, two functions in particular are highlighted: the BtfFile() constructor and processEvent().<br  />
The BtfFile constructor has a total of six input parameters, five of which have a default value. <br  />
Four of these parameters are booleans that affect the behaviour of the btf-toolchain and should be configured as needed. <br  />
The effect of these parameters is documented in the source code documentation of the BtfFile class and in the testframework are test cases that show the effect of different parameter configurations.<br  />
The processEvent() function also has an extra boolean parameter with a default value that indicates whether the process event is a Task or an ISR. The default is a Task. <br  />
 </p>
<h2><a class="anchor" id="autotoc_md19"></a>
When to start the BTF trace</h2>
<p>In the BTF format, the Stimulus, Runnable, Scheduler, OS and Signal events have one or more event types that require a running process as the event source. <br  />
Therefore, the btf-toolchain operates under the rule that a process event that allocates the process to a core must have occurred before any of the above events. <br  />
This means that if the trace is started at any point during runtime and, for example, the process start event is missing, the btf-toolchain will report either <br  />
a "no task running" or "source task not running" error if one of the above events is triggered with that process (or core on which the process should run) as the source.<br  />
An exception to this rule is made for runnable events if a process event of the source process occurs in the trace later on. <br  />
In this case, there is a fallback mechanism that collects all runnables without a task and then assigns them to the correct task. <br  />
This particular use case is also illustrated in the "Start of trace during runnable execution" test case.<br  />
 </p>
<h2><a class="anchor" id="autotoc_md20"></a>
Limitations</h2>
<p>The btf-toolchain is based on the BTF Technical Specifiaction Version 2.2.1. However, not all features described in the specification could be implemented. <br  />
In the following, the limitations of the btf-toolchain are listed.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Event Entity   </th><th class="markdownTableHeadNone">Event Type   </th><th class="markdownTableHeadNone">Limitation    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Stimulus   </td><td class="markdownTableBodyNone">trigger   </td><td class="markdownTableBodyNone">Although the specification allows for an external or inter-process source,<br  />
 the btf-toolchain only supports an external source.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">OS Event   </td><td class="markdownTableBodyNone">set_event   </td><td class="markdownTableBodyNone">The specification allows a process or a stimulus as a source.<br  />
 However, the btf-toolchain only supports a process or core as a source.   </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
